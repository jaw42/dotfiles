#!/bin/bash

addressBook=~/.mutt/aliases
    
echo "Some text that is new"

while [ ${#addresses[@]} -eq 0 ]; do
    if [[ $# -eq 0 ]]; then
        echo -n "Search: "
        read name; 
        echo -e ""
    else
        name="$1"
    fi

    echo "Something new"

    addresses=($(cat $addressBook | grep "$name" | sed 's/.*<\(.*\)>.*/\1/' ))
    IFS=$'\n'
    names=($(cat $addressBook | grep "$name" | awk '{print $3 " " $4}'))
    unset IFS

    num=0

    for i in ${addresses[@]}; do
        echo -e "$num ${names[$num]} \t$i"
        num=$(($num+1))
    done

    if [[ ${#addresses[@]} -gt 1 ]]; then
        echo -ne "\nSelect an address: "
        read addressNum
        sendTo=${addresses[$addressNum]}
        echo "$sendTo"
    else
        sendTo=${addresses[0]}
    fi

    if [[ ${#addresses[@]} -eq 0 ]];then
        echo "Name not found, please search again"
    fi
done

echo -e "-------------------- $sendTo --------------------"
#for i in {1..$COLUMNS};do echo -n "=";done

echo -n "Subject: "
read subject
mailx -s "$subject" "$sendTo"
